<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vite + Vue</title>
  <link rel="preload" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <script src="https://cdn.shopify.com/s/files/1/0583/5810/4213/files/8-swiper-bundle.min.js?v=1663912984"> </script>
  <script src="/jquery.js"></script>
  <!-- <script src="/shopInfoList-de-4.js"></script> -->
  <!-- <script src="/laydatev4-de.js"></script> -->
  <link rel="stylesheet" href="https://cdn.shopify.com/s/files/1/0583/5810/4213/files/laydatev3.css">
  <!-- <script src="https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.3.3/dist/jBox.all.min.js"></script>
  <link href="https://cdn.jsdelivr.net/gh/StephanWagner/jBox@v1.3.3/dist/jBox.all.min.css" rel="stylesheet"> -->
</head>
<style>
  * {
    margin: 0;
    padding: 0;
    border: 0;
  }

  body {
    font-family: Urbane;
  }

  div {
    box-sizing: border-box;
  }

  img,
  video {
    width: 100%;
    height: auto;
  }


  a {
    text-decoration: none;
  }
</style>

<body>
  <div id="app"></div>
  <script type="module" src="/src/main.js"></script>
</body>
<script>
  let temp = `“It's incredibly fun to ride”`

  function moveTop(text, target) {
    const active = target.getAttribute('active')

    if (active !== null) {
      return
    }

    const current = document.querySelector('#section1 .logos img[active]')

    current.removeAttribute('active')
    target.setAttribute('active', '')

    const texts = document.querySelector('#section1 .texts')
    texts.innerHTML = `
                          <div class="toBottom">${temp}</div>
                          <div class="toTop">${text}</div>
                        `

    temp = text
  }
</script>
<script>
  function changeBike(gotoUrl, imgUrl, target) {
    const parent = target.parentNode

    const active = parent.querySelector('.active')

    active.className = ''
    target.className = 'active'

    const img = parent.parentNode.querySelector('img')
    img.src = imgUrl

    // 新增的代码
    const a = parent.parentNode.querySelector('a')
    a.href = gotoUrl
  }
</script>



<!-- <script>
  setTimeout(() => {
    $('.faq-title').click(function () {
      $(this)
        .siblings('.faq-content')
        .slideToggle()
        .parent()
        .siblings()
        .find('.faq-content')
        .slideUp();
      $(this).children('i').toggleClass('faq-content-plus');
      $(this)
        .parent()
        .siblings()
        .find('.faq-title')
        .children('i')
        .addClass('faq-content-plus');
    });
  }, 300)
</script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/ip-geolocation-api-jquery-sdk@1.1.0/ipgeolocation.min.js"></script>

<script>
    // On call to IPGeolocation API on each page during a user's visit, API response will be served from sessionStorage after the first page.
    _ipgeolocation.enableSessionStorage(true);

    var ip = sessionStorage.getItem("ip");
    var country_name = sessionStorage.getItem("country_name");
    var country_code2 = sessionStorage.getItem("country_code2");
            
    if (!ip || !country_name || !country_code2) {
        _ipgeolocation.makeAsyncCallsToAPI(true);
        // _ipgeolocation.setFields("country_name,country_code2");
        _ipgeolocation.getGeolocation(handleResponse, "661e242aa9684868a4af9d9accc6e915");
    }

    function handleResponse(json) {
      console.log(json)

        ip = json.ip;
        country_name = json.country_name;
        country_code2 = json.country_code2;
    }
                
</script> -->
<!-- <script>
const testRides = [
  {
    city: 'Frankfurt am Main',
    cityBackground: 'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/testrideshopimg-Frankfurt.jpg',
    stores: [
      {
        name: 'TP',
        phone: '+0049 1741 767140',
        email: 'yicxie2017@gmail.com',
        timezone: "Mainz, Germany (GMT+1)",
        add: "Am Sonnigen Hang 21 55127 Mainz Germany",
        imgUrl: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/testrideshopimg-Frankfurt.jpg?v=1667370876",
        testrideSpot: "Frankfurt",
        testRideSize: "M/L",
        businessHours: [
          "09:00–19:00",
          "09:00–19:00",
          "09:00–19:00",
          "09:00–19:00",
          "",
          "09:00–19:00",
          "09:00–19:00",
        ],
      },
      {
        name: 'Service Zentrum',
        phone: '+004961032076414',
        email: 'yiming.song@iedau.com',
        timezone: "Mainz, Germany (GMT+1)",
        add: "IED Fulfillment-Service GmbH c/o Urtopia Service Otto-Hahn-Str. 5-7 63225 Langen",
        imgUrl: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/testrideshopimg-Frankfurt.jpg?v=1667370876",
        testrideSpot: "Frankfurt",
        testRideSize: "",
        businessHours: [
          "09:00–19:00",
          "09:00–19:00",
          "09:00–19:00",
          "09:00–19:00",
          "",
          "09:00–19:00",
          "09:00–19:00",
        ],
      },
      {
        name: 'mein-fahrradhaendler',
        phone: '+00496101 9951561',
        email: 'yicxie2017@gmail.com',
        timezone: "Mainz, Germany (GMT+1)",
        add: "Alt Erlenbach 35, 60437 Frankfurt/Main",
        imgUrl: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/testrideshopimg-Frankfurt.jpg?v=1667370876",
        testrideSpot: "Frankfurt",
        testRideSize: "L",
        businessHours: [
          "09:00–19:00",
          "09:00–19:00",
          "09:00–19:00",
          "09:00–19:00",
          "",
          "09:00–19:00",
          "09:00–19:00",
        ],
      }
    ]
  }
]


const createContent = city => {
    const find = testRides.find(c => c.city === city)

    console.log(find)

    if (!find) {
        return
    }

    return `<div class="store-list">
            <div class="list">
                ${find.stores.map(store => `<div class="item">
                    <div class="u30DemiBold">${store.name}</div>
                    <div class="u20DemiBold">Available Model:</div>
                    <ul>
                        <li class="u20Medium">Carbon One Size ${store.testRideSize}</li>
                    </ul>
                    <div class="u20DemiBold">ADD:</div>
                    <div class="u20Medium address">${store.add}</div>
                    <div class="my-button my-button-black">Select</div>
                </div>`)}
            </div>
            <div id="storepoint-container" data-tags="de,Test Ride,${city}" data-map-id="162f21804990ff"></div>
        </div>
        `
}

const width = document.body.clientWidth
    const isMobile = width < 768
    new jBox('Modal', {
        width: isMobile ? 'calc(100vw - 30px)' : 1000,
        height: 'auto',
        title: 'Book a Test Ride',
        closeButton: 'title',
        onCreated: function () {
        },
    }).setContent(createContent('Frankfurt am Main')).open()
</script> -->

<!-- <script>
  function hideLayerSide() {
    $(".message-box").animate({}, 300, function () {
      //第一个花括号里面是动画内容，可以为空，但不能省去中括号
      $(".message-box").css({ "right": "-367px" }); //在回调函数里面改变css属性来实现transform中的动画变换
    })

    $(".message-box-mobile").animate({}, 300, function () {
      //第一个花括号里面是动画内容，可以为空，但不能省去中括号
      $(".message-box-mobile").css({ "bottom": "-180px" }); //在回调函数里面改变css属性来实现transform中的动画变换
    })
  }
  //展示div
  function showLayerSide() {
    $(".message-box").animate({}, 300, function () {
      //第一个花括号里面是动画内容，可以为空，但不能省去中括号
      $(".message-box").css({ "right": "18px" }); //在回调函数里面改变css属性来实现transform中的动画变换
    })

    $(".message-box-mobile").animate({}, 300, function () {
      //第一个花括号里面是动画内容，可以为空，但不能省去中括号
      $(".message-box-mobile").css({ "bottom": "0" }); //在回调函数里面改变css属性来实现transform中的动画变换
    })
  }
</script> -->

<!-- <script>
  function showMiniDialog(html = '') {
    $('body .mini-dialog').remove()
    setTimeout(() => {
      $("body").append(`<div class="mini-dialog" style="display: flex;">${html}</div>`)

      setTimeout(() => {
        $('body .mini-dialog > div').on('click', e => {
          e.stopPropagation();
          return false;
        })
      }, 100)
    })
  }

  function closeMiniDialog(a) {
    // console.log(a === document.querySelector('body .mini-dialog'))
    $('body .mini-dialog').remove()
  }

  showMiniDialog(`<div class="subscribe-container">
            <img class="mobileHide" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Urtopia_Photo_Sesh_9_of_14.jpg?v=1680242058" alt="">
            <img class="pcHide" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Urtopia_Photo_Sesh_9_of_14_2x_57b3bdef-c4dc-4f7a-a72e-8fbb41b596b9.jpg?v=1680245456" alt="">
            <div class="subscribe">
                <span class="u20Medium">Huge Easter Sale</span>
                <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Union_2_2x_2ad80dcd-895b-4d97-92c5-0669622ad449.png?v=1680251686">
                <span class="u17Light">Subscribe for Easter exclusive coupon and Utopia stories</span>
                <div class="email">
                    <input placeholder="Enter email here" type="email">
                    <div class="my-button my-button-black">Subscribe</div>
                </div>
            </div>
            <span class="close" onclick="closeMiniDialog()">×</span>
        </div>`)
</script> -->

<script>
  const getNowDate = (v = +new Date()) => new Date(+new Date(v) + (8 * 60 * 60 * 1000)).toISOString().split('T').shift()
  const findOffset = ([nowWeek, vailableWeek]) => {
    if (nowWeek === vailableWeek) {
      return 0
    }

    return vailableWeek > nowWeek ? vailableWeek - nowWeek : 7 - (nowWeek - vailableWeek)
  }

  const oneDay = 24 * 60 * 60 * 1000

  const findStore = name => {
    for (const city of testRides) {
      for (const store of city.stores) {
        const businessHours = store.businessHours
        const disableDate = store.disableDate || []
        // 查找可预约到星期几
        const findAvailableWeek = d => businessHours[d] ? d : findAvailableWeek(d === 6 ? 0 : ++d)
        // 可用日期计算
        const findAvalibaleDate = date => {
          const str = getNowDate(date)
          const timestamp = +new Date(str)
          const currentWeek = new Date(str).getDay()
          const AvailableWeek = findAvailableWeek(currentWeek)

          const findDisable = disableDate.find(i => getNowDate(i) === str)

          if (findDisable) {
            // console.log(str, timestamp, find, getNowDate(find))
            return findAvalibaleDate(timestamp + oneDay)
          }

          return currentWeek === AvailableWeek ? str : findAvalibaleDate(timestamp + (oneDay * findOffset([currentWeek, AvailableWeek])))
        }

        store.findAvalibaleDate = () => {
          const time = new Date(findAvalibaleDate(new Date())).toString().split(' ')

          return `${time[2]}. ${time[1]}`
        }

        if (store.name.replace(/ /g, '') === name.replace(/ /g, '')) {
          return store
        }
      }
    }
  }

  function CalendarOpen(shopPoint, shop, isSpecDay = false, timetp = 0) {
    console.log(arguments)

    laydate.render({
      elem: '#urtopia-calendar',
      lang: 'en',
      min: 0,
      max: 90,
      showBottom: false,
      position: "static",
      showSide: true,
      showInfoBottom: true,
      type: 'date',
      shopList: typeof shop === 'string' ? JSON.parse(shop.replace(/'/g, '"')) : shop,
      isSpecDay,
      TimePeriodization: timetp,
      //  shopInfo: shopInfo
    });
    let body = {
      trace_name: "testride-bookNow",
      extras: {
        "test1": shopPoint,
      }
    }
    fetch("https://api.newurtopia.com/third_part/book_ride/traces", {
      method: "POST",
      body: JSON.stringify(body),
      headers: {
        "Content-Type": "application/json",
      },
    })
  }


  function booknow(name) {
    const store = findStore(name)

    if (!store) {
      return
    }


    console.log(store)

    CalendarOpen(store.testrideSpot, { [store['phone']]: store })
  }


  function splitTimeFormat(item = '') {
    if (!item) {
      return ''
    }

    const times = []

    for (const time of item.split(',')) {
      const [start, end] = time.split('-')

      console.log(start, end)

      for (let index = Number(start.split(':').shift()); index < Number(end.split(':').shift()); index++) {
        times.push(`${index}:00-${index + 1}:00`)
      }

    }

    return times
  }


  console.log(splitTimeFormat('09:00-12:00'))

</script>

</html>